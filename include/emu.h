/*
    Copyright (c) 2026 - Yann BOYER
*/
#ifndef EMU_H
#define EMU_H

#include <stdint.h>
#include <stdbool.h>
#include "consts.h"
#include "mem.h"
#include "audio.h"
#include "cpu.h"
#include "render_engine.h"

typedef struct {
    AudioPlayer audiopl;
    Memory mem;
    CPU cpu;
    RenderEngine re;
} Emulator;

#define MAX_ROM_SIZE (0xFFF - CPU_INTERNAL_PROGRAM_COUNTER_START)
#define FONTSET_SIZE 80
static uint8_t FONTSET[FONTSET_SIZE] = {
    0xF0, 0x90, 0x90, 0x90, 0xF0, // 0
    0x20, 0x60, 0x20, 0x20, 0x70, // 1
    0xF0, 0x10, 0xF0, 0x80, 0xF0, // 2
    0xF0, 0x10, 0xF0, 0x10, 0xF0, // 3
    0x90, 0x90, 0xF0, 0x10, 0x10, // 4
    0xF0, 0x80, 0xF0, 0x10, 0xF0, // 5
    0xF0, 0x80, 0xF0, 0x90, 0xF0, // 6
    0xF0, 0x10, 0x20, 0x40, 0x40, // 7
    0xF0, 0x90, 0xF0, 0x90, 0xF0, // 8
    0xF0, 0x90, 0xF0, 0x10, 0xF0, // 9
    0xF0, 0x90, 0xF0, 0x90, 0x90, // A
    0xE0, 0x90, 0xE0, 0x90, 0xE0, // B
    0xF0, 0x80, 0x80, 0x80, 0xF0, // C
    0xE0, 0x90, 0x90, 0x90, 0xE0, // D
    0xF0, 0x80, 0xF0, 0x80, 0xF0, // E
    0xF0, 0x80, 0xF0, 0x80, 0x80, // F
};

void emu_init(Emulator* emu);
void emu_deinit(Emulator* emu);
void emu_load_rom_from_file(Emulator* emu, char* rom_path);
bool emu_re_is_pixel_on(Emulator* emu, uint8_t x, uint8_t y);
void emu_update_cpu_timers(Emulator* emu);
void emu_do_cpu_cycle(Emulator* emu);

#endif
